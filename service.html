<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´ í˜ì´ ì•„ì¹´ì´ë¸Œ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Import Map for React modules -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.292.0"
        }
    }
    </script>
    
    <!-- Babel for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom scrollbar hiding */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animations */
        @keyframes slide-up { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.4s ease-out; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useRef, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            PieChart, 
            Wallet, 
            Plus, 
            ArrowLeft, 
            MoreHorizontal, 
            ShoppingBag, 
            Watch, 
            Tv, 
            Package, 
            ChevronRight,
            X,
            CreditCard,
            Truck,
            Scan,
            Bell,
            Settings,
            Search,
            Menu,
            Image as ImageIcon,
            Trash2,
            RefreshCcw,
            CheckCircle2,
            MapPin,
            Store,
            Armchair,
            User,
            MessageCircle,
            Edit3
        } from 'lucide-react';

        const PayArchiveApp = () => {
            // ==========================================
            // [State] ë°ì´í„° ë° ìƒíƒœ ê´€ë¦¬
            // ==========================================
            const [currentView, setCurrentView] = useState('home'); // home, manage
            const [selectedItemId, setSelectedItemId] = useState(null); // ìƒì„¸ ë³´ê¸°ìš© ì•„ì´í…œ
            const [isAddModalOpen, setIsAddModalOpen] = useState(false); // ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬
            const [isProfileModalOpen, setIsProfileModalOpen] = useState(false); // í”„ë¡œí•„ ëª¨ë‹¬ - Not used for direct navigation anymore
            const [editingItem, setEditingItem] = useState(null); // ìˆ˜ì • ì¤‘ì¸ ì•„ì´í…œ ë°ì´í„°
            const [isSaleModalOpen, setIsSaleModalOpen] = useState(false); // íŒë§¤ ì„¤ì • ëª¨ë‹¬
            const [activeCategory, setActiveCategory] = useState('ALL'); // ë¦¬ìŠ¤íŠ¸ í•„í„°
            const [dashboardTab, setDashboardTab] = useState('current'); // ê´€ë¦¬í™”ë©´ ëŒ€ì‹œë³´ë“œ íƒ­
            const [salePriceInput, setSalePriceInput] = useState(''); // íŒë§¤ê°€ ì…ë ¥ ìƒíƒœ

            // ì´ˆê¸° ë°ì´í„° (Mock Data)
            const [items, setItems] = useState([
                { 
                    id: 1, 
                    name: 'MacBook Air M2', 
                    purchaseLocation: 'Apple ê³µì‹ í™ˆí˜ì´ì§€',
                    price: 1690000, 
                    category: 'ê°€ì „ì œí’ˆ', 
                    date: '2023.01.15', 
                    images: ['bg-gray-200'], 
                    status: 'owned' 
                },
                { 
                    id: 2, 
                    name: 'ë‚˜ì´í‚¤ ë©í¬ ë¡œìš°', 
                    purchaseLocation: 'KREAM',
                    price: 129000, 
                    category: 'ì˜ë¥˜', 
                    date: '2023.03.10', 
                    images: ['bg-red-100', 'bg-red-200'], 
                    status: 'selling', 
                    sellingPrice: 150000 
                },
                { 
                    id: 3, 
                    name: 'ì• í”Œì›Œì¹˜ SE', 
                    purchaseLocation: 'ì¿ íŒ¡',
                    price: 359000, 
                    category: 'ê°€ì „ì œí’ˆ', 
                    date: '2023.05.22', 
                    images: ['bg-blue-100'], 
                    status: 'owned' 
                },
                { 
                    id: 4, 
                    name: 'êµ¬ì°Œ ì¹´ë“œì§€ê°‘', 
                    purchaseLocation: 'ì¹´ì¹´ì˜¤ ì„ ë¬¼í•˜ê¸°',
                    price: 450000, 
                    category: 'ì•¡ì„¸ì„œë¦¬', 
                    date: '2023.06.01', 
                    images: ['bg-green-100'], 
                    status: 'owned' 
                },
                { 
                    id: 5, 
                    name: 'ë‹¤ì´ìŠ¨ ì—ì–´ë©', 
                    purchaseLocation: 'í•˜ì´ë§ˆíŠ¸',
                    price: 699000, 
                    category: 'ê°€ì „ì œí’ˆ', 
                    date: '2023.08.15', 
                    images: ['bg-purple-100'], 
                    status: 'sold', 
                    soldPrice: 550000 
                },
                { 
                    id: 6, 
                    name: 'ê°€ì£½ ìì¼“', 
                    purchaseLocation: 'ë¬´ì‹ ì‚¬',
                    price: 299000, 
                    category: 'ì˜ë¥˜', 
                    date: '2023.10.11', 
                    images: ['bg-orange-100'], 
                    status: 'selling', 
                    sellingPrice: 200000 
                },
            ]);

            // ì¹´í…Œê³ ë¦¬ ì •ì˜ ('ë¦¬ë¹™' ì¶”ê°€)
            const categories = ['ì˜ë¥˜', 'ì•¡ì„¸ì„œë¦¬', 'ê°€ì „ì œí’ˆ', 'ë¦¬ë¹™', 'ê¸°íƒ€'];

            // ==========================================
            // [Logic] ê³„ì‚° ë¡œì§
            // ==========================================
            
            // í˜„ì¬ ë³´ìœ  ìì‚° (íŒë§¤ì¤‘ í¬í•¨, íŒë§¤ì™„ë£Œ ì œì™¸)
            const currentAssetValue = useMemo(() => {
                return items
                .filter(item => item.status !== 'sold')
                .reduce((acc, item) => acc + item.price, 0);
            }, [items]);

            // ì²˜ë¶„í•œ ìì‚° ëˆ„ì ì•¡ (íŒë§¤ì™„ë£Œëœ ì•„ì´í…œì˜ íŒë§¤ê°€ í•©ê³„)
            const soldAssetValue = useMemo(() => {
                return items
                .filter(item => item.status === 'sold')
                .reduce((acc, item) => acc + (item.soldPrice || 0), 0);
            }, [items]);

            // ì²˜ë¶„í•œ ìì‚° ì›ê¸ˆ í•©ê³„ (ìˆ˜ìµë¥  ê³„ì‚°ìš©)
            const soldAssetOriginalValue = useMemo(() => {
                return items
                .filter(item => item.status === 'sold')
                .reduce((acc, item) => acc + item.price, 0);
            }, [items]);

            // ì¹´í…Œê³ ë¦¬ í†µê³„ (ë³´ìœ  ìì‚° ê¸°ì¤€)
            const categoryStats = useMemo(() => {
                const targetItems = items.filter(item => item.status !== 'sold');
                const stats = targetItems.reduce((acc, item) => {
                acc[item.category] = (acc[item.category] || 0) + item.price;
                return acc;
                }, {});
                
                return Object.keys(stats).map(key => ({
                name: key,
                value: stats[key],
                ratio: currentAssetValue > 0 ? (stats[key] / currentAssetValue) * 100 : 0
                })).sort((a, b) => b.value - a.value);
            }, [items, currentAssetValue]);

            const filteredItems = useMemo(() => {
                let target = items;
                if (activeCategory !== 'ALL') {
                target = target.filter(item => item.category === activeCategory);
                }
                return target;
            }, [items, activeCategory]);

            // íŒë§¤ ì „í™˜ ì™„ë£Œ ì²˜ë¦¬
            const completeSaleConversion = (id, sellingPrice) => {
                const updatedStatus = { status: 'selling', sellingPrice: parseInt(sellingPrice) };

                setItems(prevItems => prevItems.map(item =>
                    item.id === id
                    ? { ...item, ...updatedStatus }
                    : item
                ));
                
                // Note: The selectedItemId might need to be re-evaluated if ItemDetailModal is closed after this.
                // For now, keeping it consistent with the id of the item that was just converted.
                setSelectedItemId(id); 
                setIsSaleModalOpen(false);
                setSalePriceInput('');
            };

            // íŒë§¤ ì¤‘ì§€ ì²˜ë¦¬ (ì†Œì¥ìš©ìœ¼ë¡œ ë³€ê²½) - ëª¨ë‹¬ ë‹«ê¸°
            const handleStopSelling = (id) => {
                if (confirm("íŒë§¤ë¥¼ ì¤‘ì§€í•˜ê³  ë‹¤ì‹œ ì†Œì¥ìš© ìì‚°ìœ¼ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                const updatedStatus = { status: 'owned', sellingPrice: undefined };
                
                setItems(prevItems => prevItems.map(item =>
                    item.id === id
                    ? { ...item, ...updatedStatus }
                    : item
                ));

                setSelectedItemId(null);
                }
            };

            // íŒë§¤ ì™„ë£Œ ì²˜ë¦¬ - ëª¨ë‹¬ ë‹«ê¸°
            const handleSoldComplete = (id) => {
                const itemToComplete = items.find(item => item.id === id); // Get the actual item for confirmation message
                if (!itemToComplete) return;

                const finalPrice = itemToComplete.sellingPrice || itemToComplete.price; 
                
                if (confirm(`${finalPrice.toLocaleString()}ì›ì— íŒë§¤ë¥¼ í™•ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                const updatedStatus = { status: 'sold', soldPrice: finalPrice };

                setItems(prevItems => prevItems.map(item =>
                    item.id === id
                    ? { ...item, ...updatedStatus }
                    : item
                ));

                setSelectedItemId(null);
                }
            };

            // ê²Œì‹œê¸€ ìˆ˜ì •
            const handleEditPost = (id) => {
                const itemToEdit = items.find(item => item.id === id);
                if (!itemToEdit) return;
                setEditingItem(itemToEdit); // ìˆ˜ì •í•  ì•„ì´í…œ ì„¤ì •
                setIsAddModalOpen(true);      // ëª¨ë‹¬ ì—´ê¸°
                setSelectedItemId(null);        // ìƒì„¸ ë·° ë‹«ê¸° (ìˆ˜ì • ëª¨ë‹¬ë¡œ ì „í™˜)
            };

            // ëª¨ë‹¬ ë‹«ì„ ë•Œ ì´ˆê¸°í™”
            const closeAddModal = () => {
                setIsAddModalOpen(false);
                setEditingItem(null);
            };

            // ì•„ì´í…œ ì‚­ì œ
            const handleDeleteItem = (id) => {
                if (confirm("ì •ë§ë¡œ ì´ ì•„ì´í…œì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
                    setItems(prevItems => prevItems.filter(item => item.id !== id));
                    setSelectedItemId(null); // ëª¨ë‹¬ ë‹«ê¸°
                }
            };

            // íŒë§¤ ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
            const openSaleSettingModal = (id, initialPrice) => {
                setSelectedItemId(id);
                setSalePriceInput(initialPrice);
                setIsSaleModalOpen(true);
            };

            // ==========================================
            // [Components] ë‚´ë¶€ ì»´í¬ë„ŒíŠ¸
            // ==========================================

            const DonutChart = ({ data, size = "w-36 h-36" }) => {
                let cumulativePercent = 0;
                const colors = ['#FFEB00', '#3B82F6', '#10B981', '#F43F5E', '#A855F7']; 

                const getCoordinatesForPercent = (percent) => {
                const x = Math.cos(2 * Math.PI * percent);
                const y = Math.sin(2 * Math.PI * percent);
                return [x, y];
                };

                return (
                <div className={`relative ${size} mx-auto my-2`}>
                    <svg viewBox="-1 -1 2 2" className="transform -rotate-90 w-full h-full">
                    {data.length > 0 ? data.map((slice, index) => {
                        const start = cumulativePercent;
                        const end = start + (slice.value / currentAssetValue);
                        cumulativePercent = end;
                        const [startX, startY] = getCoordinatesForPercent(start);
                        const [endX, endY] = getCoordinatesForPercent(end);
                        const largeArcFlag = end - start > 0.5 ? 1 : 0;
                        return (
                        <path
                            key={index}
                            d={`M ${startX} ${startY} A 1 1 0 ${largeArcFlag} 1 ${endX} ${endY} L 0 0`}
                            fill={colors[index % colors.length]}
                            stroke="white"
                            strokeWidth="0.05"
                        />
                        );
                    }) : (
                        <circle cx="0" cy="0" r="1" fill="#eee" />
                    )}
                    <circle cx="0" cy="0" r="0.65" fill="white" />
                    </svg>
                </div>
                );
            };

            const getIcon = (category) => {
                switch(category) {
                case 'ì˜ë¥˜': return <ShoppingBag size={24} />;
                case 'ì•¡ì„¸ì„œë¦¬': return <Watch size={24} />;
                case 'ê°€ì „ì œí’ˆ': return <Tv size={24} />;
                case 'ë¦¬ë¹™': return <Armchair size={24} />; // ë¦¬ë¹™ ì•„ì´ì½˜
                default: return <Package size={24} />;
                }
            };

            const ImageRenderer = ({ src, className }) => {
                if (src.startsWith('bg-')) {
                return <div className={`w-full h-full ${src} ${className}`} />;
                }
                return <img src={src} alt="item" className={`w-full h-full object-cover ${className}`} />;
            };

            // ==========================================
            // [Views] í™”ë©´ ë Œë”ë§
            // ==========================================

            // --- í™”ë©´ 1: í™ˆ ëŒ€ì‹œë³´ë“œ ---
            const renderHome = () => (
                <div className="bg-[#F1F2F4] min-h-screen pb-20 animate-fade-in relative flex flex-col">
                {/* Top Navigation */}
                <div className="bg-[#FFEB00] px-5 py-4 flex justify-between items-center sticky top-0 z-30">
                    <div className="flex space-x-5 text-[#191919] font-bold text-lg">
                    <span className="opacity-100 border-b-2 border-[#191919] pb-1">í™ˆ</span>
                    <span className="opacity-40">ìì‚°</span>
                    <span className="opacity-40">í˜œíƒ</span>
                    </div>
                    <div className="flex space-x-4 text-[#191919]">
                    <Search size={24} />
                    <Bell size={24} />
                    <Settings size={24} />
                    </div>
                </div>

                {/* Main Pay Card */}
                <div className="bg-[#FFEB00] px-5 pb-8 rounded-b-[2rem] shadow-sm relative z-10 flex-shrink-0">
                    <div className="bg-white rounded-2xl p-5 shadow-lg mt-2">
                    <div className="flex justify-between items-center mb-6">
                        <span className="font-bold text-gray-600">ì¹´ì¹´ì˜¤í˜ì´ë¨¸ë‹ˆ</span>
                        <MoreHorizontal size={20} className="text-gray-400" />
                    </div>
                    <div className="flex justify-between items-end mb-4">
                        <span className="text-3xl font-extrabold">25,800ì›</span>
                        <button className="bg-[#F1F2F4] text-xs font-bold px-3 py-1.5 rounded-full text-gray-600">
                        ì†¡ê¸ˆ
                        </button>
                    </div>
                    <div className="flex space-x-2">
                        <button className="flex-1 bg-[#FFEB00] py-3 rounded-xl font-bold text-sm">ì¶©ì „</button>
                        <button className="flex-1 bg-[#F1F2F4] py-3 rounded-xl font-bold text-sm text-gray-700">ê²°ì œ</button>
                    </div>
                    </div>
                </div>

                {/* Pay Archive Dashboard */}
                <div className="px-5 mt-10 relative z-10 flex-1">
                    <div className="flex items-center justify-between mb-3 px-1">
                    <h2 className="text-lg font-bold text-[#191919] drop-shadow-sm">ë§ˆì´ í˜ì´ ì•„ì¹´ì´ë¸Œ</h2>
                    </div>

                    <div className="bg-white rounded-2xl p-5 shadow-md">
                    <div className="flex items-start justify-between">
                        <div className="flex-1 pr-2">
                        <p className="text-xs text-gray-500 mb-1">ì§€ê¸ˆê¹Œì§€ ëª¨ì€ ì•„ì´í…œ ìì‚°</p>
                        <p className="text-2xl font-extrabold text-[#191919] mb-4">
                            {currentAssetValue.toLocaleString()}ì›
                        </p>
                        
                        <div className="space-y-2 mb-4">
                            {categoryStats.slice(0, 3).map((stat, idx) => (
                            <div key={idx} className="flex items-center text-xs">
                                <div className={`w-2 h-2 rounded-full mr-2 bg-[${['#FFEB00', '#3B82F6', '#10B981', '#F43F5E'][idx % 4]}]`}></div>
                                <span className="text-gray-500 w-14 truncate">{stat.name}</span>
                                <span className="font-bold text-gray-800">{stat.ratio.toFixed(0)}%</span>
                            </div>
                            ))}
                        </div>

                        {soldAssetValue > 0 && (
                            <div className="bg-gray-50 rounded-lg p-2 mt-2">
                            <p className="text-[10px] text-gray-400">ì§€ê¸ˆê¹Œì§€ ì²˜ë¶„í•œ ì•„ì´í…œ ìì‚°</p>
                            <p className="text-sm font-bold text-gray-600">+{soldAssetValue.toLocaleString()}ì›</p>
                            </div>
                        )}
                        </div>

                        <div className="flex-shrink-0 relative">
                        <DonutChart data={categoryStats} size="w-32 h-32" />
                        <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                            <span className="text-[10px] text-gray-500">ë³´ìœ  ìì‚°</span>
                            <span className="text-xs font-bold text-gray-800">
                            {(currentAssetValue / 10000).toFixed(0)}ë§Œì›
                            </span>
                        </div>
                        </div>
                    </div>
                    
                    <div className="w-full h-[1px] bg-gray-100 my-4"></div>
                    
                    <button 
                        onClick={() => setCurrentView('manage')}
                        className="w-full bg-[#F8F9FA] py-3 rounded-xl text-sm font-bold text-gray-700 flex items-center justify-center hover:bg-gray-100 transition-colors"
                    >
                        <Wallet size={16} className="mr-2" />
                        ì „ì²´ ìì‚° ë³´ëŸ¬ê°€ê¸°
                    </button>
                    </div>

                    <div className="mt-6 mb-8">
                    <h3 className="font-bold text-lg mb-3 px-1 text-gray-800">ì¶”ì²œ ì„œë¹„ìŠ¤</h3>
                    <div className="grid grid-cols-2 gap-3">
                        <div className="bg-white p-4 rounded-xl shadow-sm h-24 flex flex-col justify-center">
                        <span className="text-sm font-bold block mb-1">ì‹ ìš©ê´€ë¦¬</span>
                        <span className="text-xs text-gray-500">ë‚´ ì ìˆ˜ í™•ì¸í•˜ê¸°</span>
                        </div>
                        <div className="bg-white p-4 rounded-xl shadow-sm h-24 flex flex-col justify-center">
                        <span className="text-sm font-bold block mb-1">ë³´í—˜ì§„ë‹¨</span>
                        <span className="text-xs text-gray-500">ë¶€ì¡±í•œ ë³´ì¥ ì°¾ê¸°</span>
                        </div>
                    </div>
                    </div>
                </div>
                
                {/* Bottom Tab Bar */}
                <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 py-3 px-6 flex justify-between items-center text-xs font-medium text-gray-400 z-50 rounded-t-2xl shadow-[0_-5px_10px_rgba(0,0,0,0.02)] max-w-md mx-auto">
                    <div className="flex flex-col items-center text-[#191919]">
                    <Wallet size={24} className="mb-1" />
                    í™ˆ
                    </div>
                    <div className="flex flex-col items-center">
                    <PieChart size={24} className="mb-1" />
                    ìì‚°
                    </div>
                    <div className="flex flex-col items-center">
                    <Scan size={24} className="mb-1 bg-[#FFEB00] p-1 rounded-md text-[#191919]" />
                    ê²°ì œ
                    </div>
                    <div className="flex flex-col items-center">
                    <CreditCard size={24} className="mb-1" />
                    ê¸ˆìœµ
                    </div>
                    <div className="flex flex-col items-center">
                    <Menu size={24} className="mb-1" />
                    ì „ì²´
                    </div>
                </div>
                </div>
            );

            // --- í™”ë©´ 2: ê´€ë¦¬ (ìƒì„¸ í˜ì´ì§€) ---
            const renderManage = () => (
                <div className="h-screen flex flex-col bg-[#F1F2F4] animate-slide-in-right relative z-50">
                {/* Header */}
                <div className="bg-white shadow-sm z-10 sticky top-0 rounded-b-2xl">
                    <div className="px-5 pt-4 pb-2 flex justify-between items-center">
                    <button onClick={() => setCurrentView('home')} className="p-2 -ml-2">
                        <ArrowLeft size={24} className="text-[#191919]" />
                    </button>
                    <h2 className="text-lg font-bold text-[#191919]">ìì‚° ë³´ê´€í•¨</h2>
                    <div className="flex items-center -mr-2">
                        {/* í”„ë¡œí•„ ë²„íŠ¼ ì¶”ê°€ */}
                        <a href="index.html" className="p-2 mr-1 text-[#191919] hover:bg-gray-100 rounded-full">
                            <User size={24} />
                        </a>
                        <button onClick={() => setIsAddModalOpen(true)} className="p-2 text-[#191919] font-bold text-sm">
                        ì¶”ê°€
                        </button>
                    </div>
                    </div>

                    {/* ìƒì„¸ ìì‚° í˜„í™© ëŒ€ì‹œë³´ë“œ (ë¶„ë¦¬í˜•) */}
                    <div className="px-5 pb-4">
                    <div className="flex space-x-1 mb-3 bg-[#F1F2F4] p-1 rounded-lg">
                        <button 
                        onClick={() => setDashboardTab('current')}
                        className={`flex-1 py-1.5 text-xs font-bold rounded-md transition-all ${dashboardTab === 'current' ? 'bg-white text-[#191919] shadow-sm' : 'text-gray-400'}`}
                        >
                        í˜„ì¬ ë³´ìœ  ìì‚°
                        </button>
                        <button 
                        onClick={() => setDashboardTab('sold')}
                        className={`flex-1 py-1.5 text-xs font-bold rounded-md transition-all ${dashboardTab === 'sold' ? 'bg-white text-[#191919] shadow-sm' : 'text-gray-400'}`}
                        >
                        ì²˜ë¶„ ì™„ë£Œ ìì‚°
                        </button>
                    </div>

                    <div className="bg-[#F8F9FA] rounded-2xl p-5 border border-gray-100">
                        {dashboardTab === 'current' ? (
                        // Case 1: ë³´ìœ  ìì‚° ëŒ€ì‹œë³´ë“œ
                        <div>
                            <p className="text-xs text-gray-500 mb-1">ë‚´ ë°© ì•ˆì— ìˆëŠ” ìì‚° ê°€ì¹˜</p>
                            <div className="flex justify-between items-end mb-4">
                            <p className="text-2xl font-extrabold text-[#191919]">{currentAssetValue.toLocaleString()}ì›</p>
                            <span className="bg-[#FFEB00] text-[#191919] text-[10px] font-bold px-2 py-1 rounded-full">
                                {items.filter(i => i.status !== 'sold').length}ê°œ ë³´ìœ ì¤‘
                            </span>
                            </div>
                            
                            {/* ì¹´í…Œê³ ë¦¬ë³„ ë””í…Œì¼ ë°” */}
                            <div className="space-y-3">
                            {categoryStats.map((stat, idx) => (
                                <div key={idx} className="space-y-1">
                                <div className="flex justify-between text-xs">
                                    <span className="text-gray-600 font-medium">{stat.name}</span>
                                    <span className="text-gray-900 font-bold">{stat.value.toLocaleString()}ì› ({stat.ratio.toFixed(0)}%)</span>
                                </div>
                                <div className="w-full h-1.5 bg-gray-200 rounded-full overflow-hidden">
                                    <div 
                                    className={`h-full bg-[${['#FFEB00', '#3B82F6', '#10B981', '#F43F5E', '#A855F7'][idx % 5]}]`} 
                                    style={{ width: `${stat.ratio}%` }}
                                    ></div>
                                </div>
                                </div>
                            ))}
                            </div>
                        </div>
                        ) : (
                        // Case 2: ì²˜ë¶„ ìì‚° ëŒ€ì‹œë³´ë“œ
                        <div>
                            <p className="text-xs text-gray-500 mb-1">ì§€ê¸ˆê¹Œì§€ íŒë§¤ë¡œ í˜„ê¸ˆí™”í•œ ê¸ˆì•¡</p>
                            <div className="flex justify-between items-end mb-4">
                            <p className="text-2xl font-extrabold text-blue-600">+{soldAssetValue.toLocaleString()}ì›</p>
                            <span className="bg-blue-100 text-blue-600 text-[10px] font-bold px-2 py-1 rounded-full">
                                {items.filter(i => i.status === 'sold').length}ê°œ íŒë§¤ì™„ë£Œ
                            </span>
                            </div>
                            
                            <div className="flex justify-between items-center text-xs bg-white p-3 rounded-xl border border-gray-100">
                            <span className="text-gray-500">ì›ê¸ˆ ëŒ€ë¹„ íšŒìˆ˜ìœ¨</span>
                            <span className="font-bold text-[#191919]">
                                {soldAssetOriginalValue > 0 
                                ? ((soldAssetValue / soldAssetOriginalValue) * 100).toFixed(1) 
                                : 0}%
                            </span>
                            </div>
                        </div>
                        )}
                    </div>
                    </div>

                    {/* Category Tabs */}
                    <div className="flex space-x-2 overflow-x-auto scrollbar-hide px-5 pb-4">
                    <button 
                        onClick={() => setActiveCategory('ALL')}
                        className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${activeCategory === 'ALL' ? 'bg-[#191919] text-white' : 'bg-gray-100 text-gray-500'}`}
                    >
                        ì „ì²´
                    </button>
                    {categories.map(cat => (
                        <button 
                        key={cat}
                        onClick={() => setActiveCategory(cat)}
                        className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-colors ${activeCategory === cat ? 'bg-[#191919] text-white' : 'bg-gray-100 text-gray-500'}`}
                        >
                        {cat}
                        </button>
                    ))}
                    </div>
                </div>

                {/* Grid List */}
                <div className="flex-1 overflow-y-auto p-4">
                    <div className="grid grid-cols-3 gap-2 pb-20">
                    {filteredItems.map(item => (
                        <div 
                        key={item.id} 
                        onClick={() => setSelectedItemId(item.id)}
                        className="aspect-square bg-white rounded-xl overflow-hidden shadow-sm relative cursor-pointer active:opacity-90 border border-gray-100"
                        >
                        <div className={`w-full h-full flex items-center justify-center relative`}>
                            <ImageRenderer src={item.images[0]} />
                            {item.images.length > 1 && (
                            <div className="absolute top-2 right-2 bg-black/50 text-white text-[9px] px-1.5 rounded-full z-10">
                                +{item.images.length - 1}
                            </div>
                            )}
                            {item.images[0].startsWith('bg-') && (
                            <div className="absolute inset-0 flex items-center justify-center opacity-30">
                                {getIcon(item.category)}
                            </div>
                            )}
                        </div>
                        
                        <div className="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/70 via-black/40 to-transparent p-2 pt-8">
                            <p className="text-white text-[11px] font-medium truncate leading-tight">{item.name}</p>
                            <p className="text-[#FFEB00] text-[10px] font-bold mt-0.5">{(item.price/10000).toFixed(0)}ë§Œ</p>
                        </div>

                        {item.status === 'selling' && (
                            <div className="absolute top-2 left-2 bg-[#FFEB00] text-[#191919] text-[9px] font-extrabold px-1.5 py-0.5 rounded shadow-sm z-10">
                            íŒë§¤ì¤‘
                            </div>
                        )}
                        {item.status === 'sold' && (
                            <div className="absolute inset-0 bg-black/60 flex items-center justify-center z-20">
                            <div className="border border-white text-white text-xs font-bold px-2 py-1 rounded">
                                íŒë§¤ì™„ë£Œ
                            </div>
                            </div>
                        )}
                        </div>
                    ))}
                    
                    <button 
                        onClick={() => setIsAddModalOpen(true)}
                        className="aspect-square bg-white rounded-xl flex flex-col items-center justify-center text-gray-400 hover:bg-gray-50 transition-colors border border-dashed border-gray-300"
                    >
                        <Plus size={24} className="mb-1 opacity-50" />
                        <span className="text-[10px] font-medium">ì¶”ê°€</span>
                    </button>
                    </div>
                </div>
                </div>
            );

            // --- ëª¨ë‹¬: í”„ë¡œí•„ (NEW) ---
            const ProfileModal = () => {
                const [showArchivePreview, setShowArchivePreview] = useState(false);
                const recentItems = items.slice(0, 9); // ìµœê·¼ ì•„ì´í…œ 9ê°œ

                return (
                <div className="fixed inset-0 z-[80] flex items-center justify-center bg-black/90 backdrop-blur-sm animate-fade-in">
                    <div className="w-full max-w-md h-full flex flex-col relative text-white">
                    {/* Close Button */}
                    <button 
                        onClick={() => setIsProfileModalOpen(false)}
                        className="absolute top-6 left-6 z-50 p-2"
                    >
                        <X size={24} />
                    </button>

                    {/* Profile Content */}
                    <div className="flex-1 flex flex-col items-center justify-end pb-32">
                        {/* Profile Image (ì–´í”¼ì¹˜ ìŠ¤íƒ€ì¼) */}
                        <div className="w-24 h-24 bg-pink-200 rounded-[3rem] mb-4 flex items-center justify-center border-2 border-white/20 relative shadow-xl overflow-hidden">
                        <div className="absolute bottom-0 w-full h-1/2 bg-pink-300 rounded-t-full"></div>
                        <User size={48} className="text-white relative z-10" />
                        </div>
                        
                        {/* Name */}
                        <h2 className="text-xl font-bold mb-2">ê¹€ì¹´í˜</h2>
                        
                        {/* Status Message */}
                        <p className="text-sm text-gray-300 bg-white/10 px-4 py-1.5 rounded-full backdrop-blur-md">
                        ì˜¤ëŠ˜ë„ í˜„ëª…í•œ ì†Œë¹„ ğŸ’¸
                        </p>
                    </div>

                    {/* Bottom Menu Bar */}
                    <div className="border-t border-white/10 py-8 px-8">
                        <div className="flex justify-around items-center">
                        {/* 1. ë‚˜ì™€ì˜ ì±„íŒ… */}
                        <div className="flex flex-col items-center gap-2 opacity-80 hover:opacity-100 cursor-pointer">
                            <MessageCircle size={24} />
                            <span className="text-xs">ë‚˜ì™€ì˜ ì±„íŒ…</span>
                        </div>

                        {/* 2. í˜ì´ ì•„ì¹´ì´ë¸Œ (NEW Feature) */}
                        <div 
                            className="flex flex-col items-center gap-2 cursor-pointer relative"
                            onClick={() => setShowArchivePreview(!showArchivePreview)}
                        >
                            <div className={`p-1 rounded-full transition-colors ${showArchivePreview ? 'text-[#FFEB00]' : 'text-white'}`}>
                            <PieChart size={24} />
                            </div>
                            <span className={`text-xs ${showArchivePreview ? 'text-[#FFEB00] font-bold' : 'text-white'}`}>í˜ì´ ì•„ì¹´ì´ë¸Œ</span>
                            
                            {/* Archive Preview Popup */}
                            {showArchivePreview && (
                            <div 
                                className="absolute bottom-24 w-80 bg-white rounded-2xl p-5 shadow-2xl animate-slide-up text-[#191919] cursor-auto"
                                onClick={(e) => e.stopPropagation()} // Prevent toggling when clicking inside
                            >
                                <div className="flex justify-between items-center mb-4">
                                <div className="flex items-center gap-1">
                                    <span className="text-sm font-bold text-gray-500">ìµœê·¼ ë“±ë¡ ì•„ì´í…œ</span>
                                    <span className="text-sm font-bold text-[#191919]">{items.length}ê°œ</span>
                                </div>
                                
                                {/* [NEW] ê´€ë¦¬ ë²„íŠ¼ */}
                                <button 
                                    onClick={() => {
                                    setIsProfileModalOpen(false);
                                    setCurrentView('manage');
                                    }}
                                    className="text-xs font-bold text-gray-500 bg-gray-100 px-3 py-1.5 rounded-lg hover:bg-gray-200 transition-colors flex items-center"
                                >
                                    ê´€ë¦¬ <ChevronRight size={12} className="ml-0.5" />
                                </button>
                                </div>

                                <div className="grid grid-cols-3 gap-2">
                                {recentItems.map((item, idx) => (
                                    <div key={idx} className="aspect-square bg-gray-100 rounded-lg overflow-hidden relative border border-gray-100">
                                    {/* Image & Icon Logic */}
                                    <div className={`w-full h-full flex items-center justify-center relative`}>
                                        <ImageRenderer src={item.images[0]} />
                                        {item.images[0].startsWith('bg-') && (
                                        <div className="absolute inset-0 flex items-center justify-center opacity-30">
                                            {React.cloneElement(getIcon(item.category), { size: 24 })}
                                        </div>
                                        )}
                                    </div>

                                    {/* Status Badges - Miniaturized */}
                                    {item.status === 'selling' && (
                                        <div className="absolute top-1 left-1 bg-[#FFEB00] text-[#191919] text-[8px] font-extrabold px-1 py-0.5 rounded shadow-sm z-10">
                                        íŒë§¤ì¤‘
                                        </div>
                                    )}
                                    {item.status === 'sold' && (
                                        <div className="absolute inset-0 bg-black/60 flex items-center justify-center z-20">
                                        <span className="text-white text-[10px] font-bold">íŒë§¤ì™„ë£Œ</span>
                                        </div>
                                    )}

                                    {/* Name Overlay */}
                                    <div className="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/60 to-transparent p-1 pt-4">
                                        <p className="text-white text-[10px] font-medium truncate">{item.name}</p>
                                    </div>
                                    </div>
                                ))}
                                {/* ë¹ˆ ê³µê°„ ì±„ìš°ê¸° (9ê°œ ë¯¸ë§Œì¼ ë•Œ) */}
                                {[...Array(Math.max(0, 9 - recentItems.length))].map((_, i) => (
                                    <div key={`empty-${i}`} className="aspect-square bg-gray-50 rounded-lg"></div>
                                ))}
                                </div>
                                
                                {/* Tail */}
                                <div className="absolute -bottom-2 left-1/2 -translate-x-1/2 w-4 h-4 bg-white rotate-45"></div>
                            </div>
                            )}
                        </div>

                        {/* 3. í”„ë¡œí•„ í¸ì§‘ */}
                        <div className="flex flex-col items-center gap-2 opacity-80 hover:opacity-100 cursor-pointer">
                            <Edit3 size={24} />
                            <span className="text-xs">í”„ë¡œí•„ í¸ì§‘</span>
                        </div>
                        </div>
                    </div>
                    </div>
                </div>
                );
            };

            // --- ëª¨ë‹¬: ì•„ì´í…œ ì¶”ê°€ ë˜ëŠ” ìˆ˜ì • ---
            const AddOrEditItemModal = () => {
                const initialImages = editingItem ? editingItem.images : [];
                const [uploadedImages, setUploadedImages] = useState(initialImages);
                
                const handleImageUpload = (e) => {
                if (e.target.files) {
                    const filesArray = Array.from(e.target.files).slice(0, 9 - uploadedImages.length); 
                    const newImages = filesArray.map(file => URL.createObjectURL(file));
                    setUploadedImages([...uploadedImages, ...newImages]);
                }
                };

                return (
                <div className="fixed inset-0 bg-black/60 z-[60] flex items-end sm:items-center justify-center backdrop-blur-sm">
                    <div className="bg-white w-full max-w-md sm:rounded-2xl rounded-t-3xl p-6 animate-slide-up max-h-[90vh] overflow-y-auto">
                    <div className="flex justify-between items-center mb-6">
                        <h3 className="text-lg font-bold">{editingItem ? 'ìì‚° ì •ë³´ ìˆ˜ì •' : 'ìì‚° ì¶”ê°€'}</h3>
                        <button onClick={closeAddModal}><X size={24} className="text-gray-500" /></button>
                    </div>
                    
                    <form onSubmit={(e) => {
                        e.preventDefault();
                        
                        // ê³µí†µ ë°ì´í„° ê°ì²´
                        const newItemData = {
                        name: e.target.name.value,
                        purchaseLocation: e.target.purchaseLocation.value,
                        price: parseInt(e.target.price.value),
                        category: e.target.category.value,
                        images: uploadedImages.length > 0 ? uploadedImages : ['bg-gray-100'],
                        };

                        if (editingItem) {
                        // ìˆ˜ì • ëª¨ë“œ: ê¸°ì¡´ ì•„ì´í…œ ì—…ë°ì´íŠ¸ (status ë“± ìœ ì§€)
                        setItems(items.map(item => 
                            item.id === editingItem.id 
                            ? { ...item, ...newItemData } 
                            : item
                        ));
                        } else {
                        // ì¶”ê°€ ëª¨ë“œ: ìƒˆ ì•„ì´í…œ ìƒì„±
                        const newItem = {
                            id: Date.now(),
                            ...newItemData,
                            date: new Date().toISOString().split('T')[0],
                            status: 'owned'
                        };
                        setItems([newItem, ...items]);
                        }
                        closeAddModal();
                    }} className="space-y-5">
                        
                        {/* ì´ë¯¸ì§€ ì—…ë¡œë“œ */}
                        <div>
                        <label className="block text-xs font-bold text-gray-500 mb-1.5">ì‚¬ì§„ ë“±ë¡ ({uploadedImages.length}/9)</label>
                        <div className="flex space-x-2 overflow-x-auto pb-2 scrollbar-hide">
                            {uploadedImages.length < 9 && (
                            <label className="flex-shrink-0 w-20 h-20 bg-gray-100 rounded-xl flex flex-col items-center justify-center cursor-pointer border border-dashed border-gray-300">
                                <ImageIcon size={20} className="text-gray-400 mb-1" />
                                <span className="text-[10px] text-gray-400">ì‚¬ì§„ ì¶”ê°€</span>
                                <input type="file" accept="image/*" multiple className="hidden" onChange={handleImageUpload} />
                            </label>
                            )}
                            {uploadedImages.map((src, idx) => (
                            <div key={idx} className="flex-shrink-0 w-20 h-20 rounded-xl overflow-hidden relative border border-gray-200">
                                <img src={src} alt="preview" className="w-full h-full object-cover" />
                                <button 
                                type="button"
                                onClick={() => setUploadedImages(uploadedImages.filter((_, i) => i !== idx))}
                                className="absolute top-1 right-1 bg-black/50 p-0.5 rounded-full"
                                >
                                <X size={12} className="text-white" />
                                </button>
                            </div>
                            ))}
                        </div>
                        </div>

                        <div>
                        <label className="block text-xs font-bold text-gray-500 mb-1.5">ìƒí’ˆëª…</label>
                        <input name="name" defaultValue={editingItem?.name} required className="w-full bg-[#F8F9FA] rounded-xl p-3.5 text-sm font-medium border-none focus:ring-2 focus:ring-[#FFEB00] outline-none" placeholder="ì˜ˆ: ë§¥ë¶ í”„ë¡œ" />
                        </div>

                        {/* êµ¬ë§¤ì²˜ ì…ë ¥ */}
                        <div>
                        <label className="block text-xs font-bold text-gray-500 mb-1.5">êµ¬ë§¤ì²˜</label>
                        <div className="relative">
                            <input name="purchaseLocation" defaultValue={editingItem?.purchaseLocation} className="w-full bg-[#F8F9FA] rounded-xl p-3.5 text-sm font-medium border-none focus:ring-2 focus:ring-[#FFEB00] outline-none pl-10" placeholder="ì˜ˆ: ë¬´ì‹ ì‚¬, ì¿ íŒ¡, ë°±í™”ì " />
                            <Store size={18} className="absolute left-3 top-3.5 text-gray-400" />
                        </div>
                        </div>

                        <div>
                        <label className="block text-xs font-bold text-gray-500 mb-1.5">êµ¬ë§¤ ê°€ê²©</label>
                        <input name="price" type="number" defaultValue={editingItem?.price} required className="w-full bg-[#F8F9FA] rounded-xl p-3.5 text-sm font-medium border-none focus:ring-2 focus:ring-[#FFEB00] outline-none" placeholder="ì› ë‹¨ìœ„ ì…ë ¥" />
                        </div>
                        <div>
                        <label className="block text-xs font-bold text-gray-500 mb-1.5">ì¹´í…Œê³ ë¦¬</label>
                        <div className="relative">
                            <select name="category" defaultValue={editingItem?.category || categories[0]} className="w-full bg-[#F8F9FA] rounded-xl p-3.5 text-sm font-medium border-none focus:ring-2 focus:ring-[#FFEB00] outline-none appearance-none">
                            {categories.map(c => <option key={c} value={c}>{c}</option>)}
                            </select>
                            <div className="absolute right-3 top-3.5 pointer-events-none">
                            <ChevronRight size={16} className="text-gray-400 rotate-90" />
                            </div>
                        </div>
                        </div>
                        <button type="submit" className="w-full bg-[#FFEB00] text-[#191919] py-4 rounded-xl font-bold mt-4 shadow-sm hover:bg-yellow-400 transition-colors">
                        {editingItem ? 'ìˆ˜ì • ì™„ë£Œ' : 'ë“±ë¡í•˜ê¸°'}
                        </button>
                    </form>
                    </div>
                </div>
                );
            };

            const SaleSettingModal = ({ 
                selectedItemId, 
                completeSaleConversion, 
                items, 
                salePriceInput, 
                setSalePriceInput, 
                setIsSaleModalOpen 
            }) => {
                const selectedItem = useMemo(() => items.find(item => item.id === selectedItemId), [selectedItemId, items]);
                
                // No need for local state and useEffect anymore, as props are passed from parent
                // The useEffect was also wrong, as it would reset the price every time the item was selected.
                // The price should be set by the parent only when the modal is opened.

                if (!selectedItem) return null; // Should not happen if selectedItemId is valid

                return (
                <div className="fixed inset-0 bg-black/60 z-[70] flex items-end sm:items-center justify-center">
                <div className="bg-white w-full max-w-md sm:rounded-2xl rounded-t-3xl p-6 animate-slide-up">
                    <div className="flex justify-between items-center mb-2">
                    <h3 className="text-lg font-bold">íŒë§¤ ì •ë³´ ì…ë ¥</h3>
                    <button onClick={() => setIsSaleModalOpen(false)}><X size={24} className="text-gray-500" /></button>
                    </div>
                    <p className="text-sm text-gray-500 mb-6">ì–¼ë§ˆì— íŒë§¤í•˜ì‹œê² ì–´ìš”?</p>

                    <div className="bg-[#F8F9FA] p-4 rounded-xl mb-6">
                    <p className="text-xs text-gray-500 mb-1">AI ì˜ˆìƒ ì‹œì„¸</p>
                    <p className="text-lg font-bold text-blue-600">
                        {selectedItem ? (selectedItem.price * 0.7).toLocaleString() : 0}ì›
                    </p>
                    </div>

                    <div className="mb-6">
                    <label className="block text-xs font-bold text-gray-500 mb-1.5">í¬ë§ íŒë§¤ê°€</label>
                    <div className="flex items-center border-b-2 border-[#191919] pb-2">
                        <input 
                        type="number" 
                        value={salePriceInput}
                        onChange={(e) => setSalePriceInput(e.target.value)}
                        placeholder="ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                        className="w-full text-2xl font-bold text-[#191919] outline-none placeholder-gray-300"
                        autoFocus
                        />
                        <span className="text-lg font-bold text-[#191919]">ì›</span>
                    </div>
                    </div>

                    <button 
                    onClick={() => completeSaleConversion(selectedItemId, salePriceInput)}
                    className={`w-full py-4 rounded-xl font-bold shadow-sm transition-colors ${salePriceInput ? 'bg-[#FFEB00] text-[#191919]' : 'bg-gray-200 text-gray-400'}`}
                    disabled={!salePriceInput}
                    >
                    íŒë§¤ ë“±ë¡ ì™„ë£Œ
                    </button>
                </div>
                </div>
            );

            // --- ëª¨ë‹¬: ì•„ì´í…œ ìƒì„¸ ---
            const ItemDetailModal = ({ 
                selectedItemId, 
                items, 
                onDeleteItem, 
                onStopSelling, 
                onSoldComplete, 
                onEditPost, 
                onSaleConversion 
            }) => {
                const selectedItem = useMemo(() => items.find(item => item.id === selectedItemId), [selectedItemId, items]);

                if (!selectedItem) return null;
                
                const [currentImageIndex, setCurrentImageIndex] = useState(0);

                useEffect(() => {
                    setCurrentImageIndex(0);
                }, [selectedItem]);

                const nextImage = () => {
                    setCurrentImageIndex((prevIndex) => (prevIndex + 1) % selectedItem.images.length);
                };

                const prevImage = () => {
                    setCurrentImageIndex((prevIndex) => 
                        (prevIndex - 1 + selectedItem.images.length) % selectedItem.images.length
                    );
                };
                
                const isSold = selectedItem.status === 'sold';
                const isSelling = selectedItem.status === 'selling';

                return (
                <div className="fixed inset-0 bg-black/60 z-[60] flex items-end sm:items-center justify-center backdrop-blur-sm">
                    <div className="bg-white w-full max-w-md h-[90vh] sm:h-auto sm:rounded-2xl rounded-t-3xl flex flex-col animate-slide-up overflow-hidden">
                    
                    {/* Image Carousel */}
                    <div className="w-full h-72 relative bg-gray-100 flex items-center justify-center"> {/* Centered content */}
                        {/* Main Image */}
                        <div className="w-full h-full relative">
                            <ImageRenderer src={selectedItem.images[currentImageIndex]} className="object-cover" />
                            {selectedItem.images[currentImageIndex].startsWith('bg-') && (
                            <div className="absolute inset-0 flex items-center justify-center opacity-40">
                                {React.cloneElement(getIcon(selectedItem.category), { size: 60 })}
                            </div>
                            )}
                        </div>

                        {/* Navigation Buttons */}
                        {selectedItem.images.length > 1 && (
                            <>
                                <button
                                    onClick={prevImage}
                                    className="absolute left-4 top-1/2 -translate-y-1/2 bg-white/60 p-2 rounded-full backdrop-blur-sm z-20"
                                >
                                    <ChevronLeft size={20} className="text-gray-700" />
                                </button>
                                <button
                                    onClick={nextImage}
                                    className="absolute right-4 top-1/2 -translate-y-1/2 bg-white/60 p-2 rounded-full backdrop-blur-sm z-20"
                                >
                                    <ChevronRight size={20} className="text-gray-700" />
                                </button>
                            </>
                        )}
                        
                        {/* Image Counter */}
                        {selectedItem.images.length > 1 && (
                        <div className="absolute bottom-4 right-4 bg-black/50 text-white text-xs px-2 py-1 rounded-full z-10">
                            {currentImageIndex + 1} / {selectedItem.images.length}
                        </div>
                        )}

                        {/* Close Button */}
                        <button 
                        onClick={() => setSelectedItemId(null)} 
                        className="absolute top-4 right-4 bg-white/60 p-2 rounded-full backdrop-blur-sm z-10"
                        >
                        <X size={20} className="text-gray-700" />
                        </button>
                        {/* Delete Button */}
                        <button
                        onClick={() => onDeleteItem(selectedItem.id)}
                        className="absolute top-4 left-4 bg-red-500/80 text-white p-2 rounded-full backdrop-blur-sm z-10"
                        >
                        <Trash2 size={20} />
                        </button>
                        
                        {isSelling && (
                        <div className="absolute bottom-4 left-4 bg-[#FFEB00] px-3 py-1.5 rounded-lg shadow-sm flex items-center z-10">
                            <Truck size={14} className="mr-1.5 text-[#191919]" />
                            <span className="text-xs font-extrabold text-[#191919]">íŒë§¤ì¤‘ â€¢ {selectedItem.sellingPrice?.toLocaleString()}ì›</span>
                        </div>
                        )}
                        {isSold && (
                        <div className="absolute bottom-4 left-4 bg-black px-3 py-1.5 rounded-lg shadow-sm flex items-center z-10">
                            <CheckCircle2 size={14} className="mr-1.5 text-white" />
                            <span className="text-xs font-extrabold text-white">íŒë§¤ì™„ë£Œ â€¢ {selectedItem.soldPrice?.toLocaleString()}ì›</span>
                        </div>
                        )}
                    </div>

                    {/* Info Area */}
                    <div className="p-6 flex-1 flex flex-col">
                        <div className="mb-8">
                        <span className="bg-gray-100 text-gray-600 text-[10px] font-bold px-2 py-1 rounded mb-2 inline-block">
                            {selectedItem.category}
                        </span>
                        <h2 className="text-2xl font-bold text-[#191919]">{selectedItem.name}</h2>
                        <div className="flex items-center text-sm text-gray-400 mt-1 space-x-2">
                            <span>{selectedItem.date} êµ¬ë§¤</span>
                            <span>â€¢</span>
                            <span className="flex items-center text-gray-500">
                            <Store size={12} className="mr-1" />
                            {selectedItem.purchaseLocation || "êµ¬ë§¤ì²˜ ë¯¸ì…ë ¥"}
                            </span>
                        </div>
                        </div>

                        <div className="space-y-5 mb-8 bg-[#F8F9FA] p-5 rounded-2xl">
                        <div className="flex justify-between items-center">
                            <span className="text-sm text-gray-500">êµ¬ë§¤ ê°€ê²©</span>
                            <span className="font-bold text-lg text-gray-400 line-through decoration-gray-400">
                            {selectedItem.price.toLocaleString()}ì›
                            </span>
                        </div>
                        
                        {!isSold && (
                            <div className="flex justify-between items-center">
                            <span className="text-sm font-bold text-[#191919] flex items-center">
                                ì˜ˆìƒ ì‹œì„¸ (AI)
                            </span>
                            <span className="font-extrabold text-2xl text-blue-600">
                                {(selectedItem.price * 0.7).toLocaleString()}ì›
                            </span>
                            </div>
                        )}
                        
                        {isSold && (
                            <div className="flex justify-between items-center">
                            <span className="text-sm font-bold text-[#191919]">ìµœì¢… íŒë§¤ê°€</span>
                            <span className="font-extrabold text-2xl text-[#191919]">
                                {selectedItem.soldPrice.toLocaleString()}ì›
                            </span>
                            </div>
                        )}
                        </div>

                        <div className="mt-auto">
                        {selectedItem.status === 'owned' && (
                            <div className="flex space-x-3">
                            <button 
                                onClick={() => onEditPost(selectedItem.id)}
                                className="flex-1 bg-gray-100 text-gray-600 py-4 rounded-xl font-bold text-sm"
                            >
                                ìˆ˜ì •
                            </button>
                            <button 
                                onClick={() => onSaleConversion(selectedItem.id, Math.floor(selectedItem.price * 0.7).toString())}
                                className="flex-[2] bg-[#FFEB00] text-[#191919] py-4 rounded-xl font-bold text-sm flex items-center justify-center shadow-sm hover:bg-yellow-400"
                            >
                                íŒë§¤ ì „í™˜í•˜ê¸° <ChevronRight size={16} className="ml-1" />
                            </button>
                            </div>
                        )}

                        {selectedItem.status === 'selling' && (
                            <div className="flex flex-col space-y-3">
                            <button 
                                onClick={() => onSoldComplete(selectedItem.id)}
                                className="w-full bg-[#191919] text-white py-4 rounded-xl font-bold text-sm flex items-center justify-center shadow-sm active:scale-95 transition-transform"
                            >
                                íŒë§¤ ì™„ë£Œ ì²˜ë¦¬í•˜ê¸° <CheckCircle2 size={16} className="ml-2" />
                            </button>
                            <div className="flex space-x-3">
                                <button 
                                onClick={() => onStopSelling(selectedItem.id)}
                                className="flex-1 bg-white border border-gray-300 text-gray-700 py-3 rounded-xl font-bold text-xs flex items-center justify-center active:bg-gray-50"
                                >
                                <RefreshCcw size={14} className="mr-1" /> íŒë§¤ ì¤‘ì§€ (ì†Œì¥)
                                </button>
                                <button 
                                onClick={() => onEditPost(selectedItem.id)}
                                className="flex-1 bg-white border border-gray-300 text-gray-700 py-3 rounded-xl font-bold text-xs active:bg-gray-50"
                                >
                                ê²Œì‹œê¸€ ìˆ˜ì •
                                </button>
                            </div>
                            </div>
                        )}

                        {selectedItem.status === 'sold' && (
                            <button disabled className="w-full bg-gray-100 text-gray-400 py-4 rounded-xl font-bold text-sm cursor-not-allowed">
                            ì´ë¯¸ íŒë§¤ëœ ì•„ì´í…œì…ë‹ˆë‹¤
                            </button>
                        )}
                        </div>
                    </div>
                    </div>
                </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-100 flex justify-center font-sans text-[#191919]">
                <div className="w-full max-w-md bg-white min-h-screen shadow-2xl relative overflow-hidden flex flex-col">
                    {currentView === 'home' ? renderHome() : renderManage()}
                    {isAddModalOpen && <AddOrEditItemModal />}
                    {selectedItemId && <ItemDetailModal 
                        selectedItemId={selectedItemId} 
                        items={items} 
                        onDeleteItem={handleDeleteItem}
                        onStopSelling={handleStopSelling}
                        onSoldComplete={handleSoldComplete}
                        onEditPost={handleEditPost}
                        onSaleConversion={openSaleSettingModal}
                    />}
                    {isSaleModalOpen && <SaleSettingModal selectedItemId={selectedItemId} completeSaleConversion={completeSaleConversion} items={items} salePriceInput={salePriceInput} setSalePriceInput={setSalePriceInput} setIsSaleModalOpen={setIsSaleModalOpen} />}
                    {/* isProfileModalOpen is not used for direct navigation anymore. */}
                    {isProfileModalOpen && <ProfileModal />}
                </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<PayArchiveApp />);
    </script>
</body>
</html>